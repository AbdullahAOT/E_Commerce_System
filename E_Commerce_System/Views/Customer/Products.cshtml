@model E_Commerce_System.ViewModels.Admin.ProductListViewModel

@{
    ViewData["Title"] = "Products";
}

<style>
    /* Ensure My Orders outline button shows white text on hover/focus like other primary buttons */
    .my-orders-btn:hover,
    .my-orders-btn:focus {
        color: #fff !important;
        text-decoration: none;
    }
</style>

<div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="m-0">Available Products</h2>
    <div>
        <a class="btn btn-secondary me-2" asp-action="Dashboard">Back to Dashboard</a>
        <a class="btn btn-outline-primary my-orders-btn" asp-action="MyOrders">My Orders</a>
    </div>
</div>

<div class="table-responsive">
    <table class="table table-bordered table-striped align-middle">
        <thead class="table-light">
            <tr>
                <th style="width:120px">Photo</th>
                <th>Name</th>
                <th>Description</th>
                <th style="width:110px">Amount</th>
                <th style="width:90px">Currency</th>
                <th style="width:120px">Actions</th>
            </tr>
        </thead>
        <tbody>
            @if (Model.Products != null && Model.Products.Count > 0)
            {
                foreach (var p in Model.Products)
                {
                    <tr>
                        <td class="text-center">
                            @if (p.Photo != null && p.Photo.Length > 0 && !string.IsNullOrEmpty(p.PhotoContentType))
                            {
                                var src = $"data:{p.PhotoContentType};base64,{System.Convert.ToBase64String(p.Photo)}";
                                <img src="@src"
                                     alt="@p.Name"
                                     class="img-fluid img-thumbnail"
                                     style="max-width:100px; max-height:100px; object-fit:cover;" loading="lazy" />
                            }
                            else
                            {
                                <!-- optional placeholder image (wwwroot/images/no-image.png) or fallback text -->
                                <img src="~/images/no-image.png" alt="No image" class="img-fluid img-thumbnail"
                                     style="max-width:100px; max-height:100px; object-fit:cover;" onerror="this.style.display='none';" />
                                <div class="small text-muted mt-1">No image</div>
                            }
                        </td>

                        <td>@p.Name</td>
                        <td class="text-truncate" style="max-width:420px;">@p.Description</td>
                        <td>@p.Amount.ToString("0.00")</td>
                        <td>@p.Currency</td>
                        <td>
                            <form asp-action="PlaceOrder" method="post" class="d-inline">
                                <input type="hidden" name="productId" value="@p.Id" />
                                <button type="submit" class="btn btn-sm btn-primary">Order</button>
                            </form>
                        </td>
                    </tr>
                }
            }
            else
            {
                <tr><td colspan="6" class="text-center">No products available.</td></tr>
            }
        </tbody>
    </table>
</div>

@if (Model.TotalPages > 1)
{
    <nav aria-label="Product pagination">
        <ul class="pagination">
            @if (Model.PageNumber > 1)
            {
                <li class="page-item">
                    <a class="page-link" asp-action="Products" asp-route-page="@(Model.PageNumber - 1)">Previous</a>
                </li>
            }

            @for (int i = 1; i <= Model.TotalPages; i++)
            {
                <li class="page-item @(i == Model.PageNumber ? "active" : "")">
                    <a class="page-link" asp-action="Products" asp-route-page="@i">@i</a>
                </li>
            }

            @if (Model.PageNumber < Model.TotalPages)
            {
                <li class="page-item">
                    <a class="page-link" asp-action="Products" asp-route-page="@(Model.PageNumber + 1)">Next</a>
                </li>
            }
        </ul>
    </nav>
}
